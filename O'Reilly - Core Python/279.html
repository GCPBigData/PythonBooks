
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Robots" content="INDEX,NOFOLLOW">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<TITLE>Safari | Core Python Programming -&gt; Web (HTTP) Servers</TITLE>
<LINK REL="stylesheet" HREF="oreillyi/oreillyM.css">
</HEAD>
<BODY bgcolor="white" text="black" link="#990000" vlink="#990000" alink="#990000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">

<table width="100%" cellpadding=5 cellspacing=0 border=0 class="navtopbg"><tr><td><font size="1"><p class="navtitle"><a href="1.html" class="navtitle">Programming</a> &gt; <a href="0130260363.html" class="navtitle">Core Python Programming</a> &gt; <a href="271.html" class="navtitle">19. Web Programming</a> &gt; <span class="nonavtitle">Web (HTTP) Servers</span></p></font></td><td align="right" valign="top" nowrap><font size="1"><a href="main.asp?list" class="safnavoff">See All Titles</a></font></td></tr></table>
<TABLE width=100% bgcolor=white border=0 cellspacing=0 cellpadding=5><TR><TD>
<TABLE border=0 width="100%" cellspacing=0 cellpadding=0><TR><td align=left width="15%" class="headingsubbarbg"><a href="278.html" title="Advanced CGI"><font size="1">&lt;&nbsp;BACK</font></a></td><td align=center width="70%" class="headingsubbarbg"><font size="1"><a href="popanote.asp?pubui=oreilly&bookname=0130260363&snode=279" target="_blank" title="Make a public or private annnotation">Make Note</a> | <a href="279.html" title="Use a Safari bookmark to remember this section">Bookmark</a></font></td><td align=right width="15%" class="headingsubbarbg"><a href="280.html" title="Related Modules"><font size="1">CONTINUE&nbsp;&gt;</font></a></td></TR></TABLE>
<a href="5%2F30%2F2002+8%3A43%3A08+PM.html" TABINDEX="-1"><img src=images/spacer.gif border=0 width=1 height=1></a><font color=white size=1>156135250194107072078175030179198180025031194137176049106218111004226053241016190125213244</font><a href="read9.asp?bookname=0130260363&snode=279&now=5%2F30%2F2002+8%3A43%3A08+PM" TABINDEX="-1"><img src=images/spacer.gif border=0 width=1 height=1></a><br>
<FONT>
				<h3>Web (HTTP) Servers</h3>
				<p>Until now, we have been discussing the use of Python in creating Web clients and performing tasks to aid Web servers in CGI request processing. We know (and have seen earlier in <a HREF="274.html">Sections 19.2</a> and <a hrEF="275.html">19.3</A>) that Python can be used to create both simple and complex Web clients. Complexity of CGI requests goes without saying.</P>

				<p>However, we have yet to explore the creation of Web <i>servers,</i> and that is the focus of this section. If the Netscape, IE, Opera, Mozilla, and Lynx browsers are among the most popular Web clients, then what are the most common Web servers? They are Apache, Netscape, and IIS. In situations where these servers may be overkill for your desired application, we would like to use Python to help us create simple yet useful Web servers.</p>

				
					<H4>Creating Web Servers in Python</H4>
					<P>Since you have decided on building such an application, you will naturally be creating all the custom stuff, but all the base code you will need is already available in the Python Standard Library. To create a Web server, a base server and a "handler" are required.</P>

					<p>The base (Web) server is a boilerplate item, a must have. Its role is to perform the necessary HTTP communication between client and server. The base server is (appropriately) named <tt class="monofont">HTTPServer</tt> and is found in the <tt class="monofont">BaseHTTPServer</tt> module.</p>

					<P>The handler is the piece of software which does the majority of the "Web serving." It processes the client request and returns the appropriate file, whether static or dynamically-generated by CGI. The complexity of the handler determines the complexity of your Web server. The Python standard library provides three different handlers.</p>

					<p>The most basic, plain, vanilla handler, named <Tt clAss="monofont">BaseHTTPRequestHandler,</tt> is found in the <Tt clASS="monofont">BaseHTTPServer</Tt> module, along with the base Web server. Other than taking a client request, no other handling is implemented at all, so you have to do it all yourself, such as in our <tt cLASS="monofont">myhttpd.py</tt> server below.</p>

					<p>The <TT CLass="monofont">SimpleHTTPRequestHandler,</tT> available in the <TT Class="monofont">SimpleHTTP-Server</tt> module, builds on <tt class="monofont">BaseHTTPRequestHandler</tt> by implementing the standard GET and HEAD requests in a fairly straightforward manner. Still nothing sexy, but it gets the simple jobs done.</p>

					<p>Finally, we have the <tt cLasS="monofont">CGIHTTPRequestHandler,</tt> available in the <tT clasS="monofont">CGIHTTPServer</tt> module, which takes the <tT CLAss="monofont">SimpleHTTPRequestHandler</tt> and adds support for POST requests. It has the ability to call CGI scripts to perform the requested processing and can send the generated HTML back to the client.</P>

					<P>The three modules and their classes are summarized in <A Href="279#2.html">Table 19-6</a>.</P>

					<A NAme="2"></a><p><TABLe border="1" cellspacing="0" ceLlpAddiNg="1" widTh="100%">
<caPTIOn><h5>Table 19.6. Web Server Modules and Classes</h5></cAPTIon><coLGROup alIGN="left" Span="2">
<tr valign="top">
<th>
<font sizE="2"><p><b><I>Module</i></b></p>
</Font></tH>
<th>
<fONT Size="2"><p><B><I>Description</I></B></p>
</fonT></TH>
</Tr>
<tr vALIGn="top">
<td>
<font size="2"><p><tt class="monofont">BaseHTTPServer</tT></p>
</fOnt></tD>
<td>
<foNt siZE="2"><P>provides the base Web server and base handler classes, <Tt claSS="monofont">HTTPServer</TT> and <tt clASS="monofont">BaseHTTPRequestHandler,</Tt> respectively</p>
</foNT></TD>
</tr>
<tr valign="top">
<td>
<font size="2"><P><tt ClasS="monofont">SimpleHTTPServer</tt></p>
</fOnt></tD>
<TD>
<Font sIZE="2"><P>contains the <tt clASS="monofont">SimpleHTTPRequestHandler</Tt> class to perform GET and HEAD requests</p>
</foNT></TD>
</tr>
<tr valign="top">
<td>
<font size="2"><P><tt ClasS="monofont">CGIHTTPServer</tt></p>
</fOnt></tD>
<TD>
<Font sIZE="2"><P>contains the <tt clASS="monofont">CGIHTTPRequestHandler</Tt> class to process POST requests and perform CGI execution</p>
</foNT></TD>
</tr>
</colgroup>
</table></p>

					<p>To be able to understand how the more advanced handlers found in the <tt cLasS="monofont">SimpleHTTPServer</tt> and <tT clasS="monofont">CGIHTTPServer</tt> modules work, we will implement simple GET processing for a <tT CLAss="monofont">BaseHTTPRequestHandler.</tt> In <A HREf="279#3.html">Example 19-7</a>, we present the code for a fully working Web server, <tt CLASs="monofont">myhttpd.py.</tt></p>

					<P>This server subclasses <TT Class="monofont">BaseHTTPRequestHandler</tt> and consists of a single <tt class="monofont">do_GET()</tt> method, which is called when the base server receives a GET request. We attempt to open the path passed in by the client and if present, return an "OK" status (200) and forward the downloaded Web page. If the file was not found, returning a 404 status.</p>

					<p>The <tt cLasS="monofont">main()</tt> function simply instantiates our Web server class and invokes it to run our familiar infinite server loop; shutting it down if interrupted by ^C or similar keystroke. If you have appropriate access and can run this server, you will notice that it displays loggable output which will look something like:</p>

					
						<H5>
<a namE="3"></a>Example 19.7. Simple Web Server (<tt CLASs="monofont">myhttpd.py</tt>)</h5>
						<P><B><I>This simple Web server can read GET requests, fetch a Web page (.html file) and return it to the calling client. It uses the</I></b>
							<tt cLASS="monofont">BaseHTTPRequestHandler</tt>
							<b><i>found in</I></B>
							<TT class="monofont">BaseHTTPServer</tt>
							<b><i>and implements the</i></b>
							<tt class="monofont">do_GET()</tt>
							<B><i>method to enable processing of GET requests</i></B></p>

						<prE clasS="monofont"> &lt;$nopage&gt;
001 1   #!/usr/bin/env python
002 2
003 3   <b>from</b> os <b>import</B> curdir, sep
004 4   <B>from</B> BaseHTTPServer <B>import</b> \
005 5                BaseHTTPRequestHandler, HTTPServer
006 6
007 7   <b>class</b> MyHandler(BaseHTTPRequestHandler):
008 8
009 9       <b>def</B> do_GET(self):
010 10          <B>try:</B> &lt;$nopage&gt;
011 11              f = open(curdir + sep + self.path)
012 12              self.send_response(200)
013 13              self.send_header('Content-type',
014 14                                     'text/html')
015 15              self.end_headers()
016 16              self.wfile.write(f.read())
017 17              f.close()
018 18          <B>except</b> IOError:
019 19              self.send_error(404, \
020 20                  'File Not Found: %s' % self.path)
021 21
022 22  <b>def</b> main():
023 23      <b>try:</B> &lt;$nopage&gt;
024 24          server = HTTPServer(('', 80), MyHandler)
025 25          <B>print</B> 'Welcome to the machine…',
026 26          <B>print</b> 'Press ^C once or twice to quit.'
027 27          server.serve_forever()
028 28      <b>except</b> KeyboardInterrupt:
029 29          <b>print</B> '^C received, shutting down server'
030 30          server.socket.close()
031 31
032 32  <B>if</B> __name__ == '__main__':
033 33      main()
034  &lt;$nopage&gt;</Pre>
					
					<pre>
						
# myhttpd.py
Welcome to the machine... Press ^C once or twice to quit
localhost - - [26/Aug/2000 03:01:35] "GET /index.html
HTTP/1.0" 200 -
localhost - - [26/Aug/2000 03:01:29] code 404, message
File Not Found: /dummy.html
localhost - - [26/Aug/2000 03:01:29] "GET /dummy.html
HTTP/1.0" 404 -
localhost - - [26/Aug/2000 03:02:03] "GET /hotlist.htm
HTTP/1.0" 200 -

					</pre>

					<p>Of course, our simple little Web server is so simple, that it cannot even process plain text files. We leave that as an exercise for the reader, which can be found at the end of the chapter.</p>

					<p>As you can see, it doesn't take much to have a Web server up and running in pure Python. There is plenty more you can do to enhance the handlers to customize it to your specific application. Please review the Library Reference for more information on these modules (and their classes) discussed in this section.</p>

				
			</font>
<P><TABLE width="100%" border=0><TR valign="top"><TD><font size=1 color="#C0C0C0"><br></font></TD><TD align=right><font size=1 color="#C0C0C0">Last updated on 9/14/2001<br>Core Python Programming, &copy;&nbsp;2002 Prentice Hall PTR</font></TD></TR></TABLE></P>
<TABLE border=0 width="100%" cellspacing=0 cellpadding=0><TR><td align=left width="15%" class="headingsubbarbg"><a href="278.html" title="Advanced CGI"><font size="1">&lt;&nbsp;BACK</font></a></td><td align=center width="70%" class="headingsubbarbg"><font size="1"><a href="popanote.asp?pubui=oreilly&bookname=0130260363&snode=279" target="_blank" title="Make a public or private annnotation">Make Note</a> | <a href="279.html" title="Use a Safari bookmark to remember this section">Bookmark</a></font></td><td align=right width="15%" class="headingsubbarbg"><a href="280.html" title="Related Modules"><font size="1">CONTINUE&nbsp;&gt;</font></a></td></TR></TABLE>
</TD></TR></TABLE>




<!--EndOfBrowse-->

</TD></TR></TABLE>
<table width=100% border=0 cellspacing=0 cellpadding=0 bgcolor=#990000><tr><td><p align=center><font size=1 face="verdana,arial,helvetica" color=white>© 2002, O'Reilly & Associates, Inc.</font></p></td></tr></table>
</BODY>
</HTML>